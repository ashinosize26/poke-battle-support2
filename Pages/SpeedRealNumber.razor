@page "/speedrealnumber"
@inject BattleModel Battle

<PageTitle>S実数値</PageTitle>
<MudTable Items="@Elements" Hover="true" Breakpoint="Breakpoint.None" Dense="true" Class="mx-4 mt-8" Striped="true" Bordered="true">
    <HeaderContent>
        <MudTh></MudTh>
        <MudTh></MudTh>
        <MudTh>持ち物</MudTh>
        <MudTh>最速</MudTh>
        <MudTh>準速</MudTh>
        <MudTh>無振</MudTh>
        <MudTh>下降</MudTh>
        <MudTh>最遅</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="PokemonImage">
            <PokeImageView PokeNo="@context.No" Width="42" Height="42" />
        </MudTd>
        <MudTd>
            <MudText Typo="Typo.body1">@context.Name</MudText>
        </MudTd>
        <MudTd>
            <MudText Typo="Typo.h5">@(context.ChoiceScarf == true ? "スカーフ" : "-")</MudText>
            </MudTd>
            <MudTd DataLabel="Fastest">
                <MudText Typo="Typo.body1" Color="@(context.SpeedRank == Common.SpeedRank.Fastest ? Color.Secondary : Color.Default)">@(context.FastestSpeed + (context.ChoiceScarf ? $" ({Math.Floor(context.FastestSpeed * 1.5)})" : ""))</MudText>
            </MudTd>
            <MudTd DataLabel="Fast">
                <MudText Typo="Typo.body1" Color="@(context.SpeedRank == Common.SpeedRank.Fast ? Color.Secondary : Color.Default)">@(context.FastSpeed + (context.ChoiceScarf ? $" ({Math.Floor(context.FastSpeed * 1.5)})" : ""))</MudText>
            </MudTd>
            <MudTd DataLabel="Default">
                <MudText Typo="Typo.body1" Color="@(context.SpeedRank == Common.SpeedRank.Default ? Color.Secondary : Color.Default)">@(context.DefaultSpeed + (context.ChoiceScarf ? $"({Math.Floor(context.DefaultSpeed * 1.5)})" : ""))</MudText>
            </MudTd>
            <MudTd DataLabel="Slow">
                <MudText Typo="Typo.body1">@context.SlowSpeed</MudText>
            </MudTd>
            <MudTd DataLabel="Slowest">
                <MudText Typo="Typo.body1">@context.SlowestSpeed</MudText>
            </MudTd>
        </RowTemplate>
    </MudTable>

    @code {
    /// <summary>
    /// テーブルデータ
    /// </summary>
    private List<PokeSpeedRealNumberRowModel> Elements = new List<PokeSpeedRealNumberRowModel>();

    /// <summary>
    /// コンストラクタ
    /// </summary>
    /// <returns></returns>
    protected override void OnInitialized()
    {
        // テーブルの行データの作成
        Elements.Clear();
        foreach (var poke in Battle.MyParty)
        {
            AddElements(poke);
        };
        foreach (var poke in Battle.YourParty)
        {
            AddElements(poke);
        };
    }

    /// <summary>
    /// テーブルにポケモンの追加
    /// </summary>
    /// <param name="poke"></param>
    private void AddElements(PokeModel poke)
    {
        // 未設定なら追加しない
        if (string.IsNullOrEmpty(poke.Name))
        {
            return;
        }

        // 行作成
        PokeSpeedRealNumberRowModel row = new()
            {
                No = poke.No,
                Name = poke.Name,
                ChoiceScarf = poke.BattleItem == Common.BattleItem.ChoiceScarf ? true : false,
                FastestSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Fastest),
                FastSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Fast),
                DefaultSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Default),
                SlowSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Slow),
                SlowestSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Slowest),
                SpeedRank = poke.SpeedRank,
            };

        // 行追加
        Elements.Add(row);
    }
}
