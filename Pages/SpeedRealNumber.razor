@page "/speedrealnumber"
@inject BattleModel Battle

<PageTitle>S実数値</PageTitle>
<MudTable Items="@Elements" Hover="true" Breakpoint="Breakpoint.None" Dense="true" Class="mx-4 mt-8" Striped="true">
    <HeaderContent>
        <MudTh></MudTh>
        <MudTh>最速</MudTh>
        <MudTh>準速</MudTh>
        <MudTh>無振</MudTh>
        <MudTh>下降</MudTh>
        <MudTh>最遅</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="PokemonImage">
            <PokeImageView PokeNo="@context.No" Width="42" Height="42" />
        </MudTd>
        <MudTd DataLabel="Fastest">
            @if (context.SpeedRank == Common.SpeedRank.Fastest)
            {
                <MudText Typo="Typo.body1"><b>@context.FastestSpeed</b></MudText>
            }
            else
            {
                <MudText Typo="Typo.body1">@context.FastestSpeed</MudText>
            }
        </MudTd>
        <MudTd DataLabel="Fast">
            @if (context.SpeedRank == Common.SpeedRank.Fast)
            {
                <MudText Typo="Typo.body1"><b>@context.FastSpeed</b></MudText>
            }
            else
            {
                <MudText Typo="Typo.body1">@context.FastSpeed</MudText>
            }
        </MudTd>
        <MudTd DataLabel="Default">
            @if (context.SpeedRank == Common.SpeedRank.Default)
            {
                <MudText Typo="Typo.body1"><b>@context.DefaultSpeed</b></MudText>
            }
            else
            {
                <MudText Typo="Typo.body1">@context.DefaultSpeed</MudText>
            }
        </MudTd>
        <MudTd DataLabel="Slow">
            @if (context.SpeedRank == Common.SpeedRank.Slow)
            {
                <MudText Typo="Typo.body1"><b>@context.SlowSpeed</b></MudText>
            }
            else
            {
                <MudText Typo="Typo.body1">@context.SlowSpeed</MudText>
            }
        </MudTd>
        <MudTd DataLabel="Slowest">
            @if (context.SpeedRank == Common.SpeedRank.Slowest)
            {
                <MudText Typo="Typo.body1"><b>@context.SlowestSpeed</b></MudText>
            }
            else
            {
                <MudText Typo="Typo.body1">@context.SlowestSpeed</MudText>
            }
        </MudTd>
    </RowTemplate>
</MudTable>

@code {
    /// <summary>
    /// テーブルデータ
    /// </summary>
    private List<PokeSpeedRealNumberRowModel> Elements = new List<PokeSpeedRealNumberRowModel>();

    /// <summary>
    /// コンストラクタ
    /// </summary>
    /// <returns></returns>
    protected override void OnInitialized()
    {
        // テーブルの行データの作成
        Elements.Clear();
        foreach (var poke in Battle.MyParty)
        {
            AddElements(poke);
        };
        foreach (var poke in Battle.YourParty)
        {
            AddElements(poke);
        };
    }

    /// <summary>
    /// テーブルにポケモンの追加
    /// </summary>
    /// <param name="poke"></param>
    private void AddElements(PokeModel poke)
    {
        // 未設定なら追加しない
        if (string.IsNullOrEmpty(poke.Name))
        {
            return;
        }

        // 行作成
        PokeSpeedRealNumberRowModel row = new()
            {
                No = poke.No,
                FastestSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Fastest),
                FastSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Fast),
                DefaultSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Default),
                SlowSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Slow),
                SlowestSpeed = Common.CalcSpeedRealNumber(poke.S, Common.SpeedRank.Slowest),
                SpeedRank = poke.SpeedRank,
            };

        // 行追加
        Elements.Add(row);
    }
}
