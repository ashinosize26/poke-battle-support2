<MudTable Items="@elements" Hover="true" Breakpoint="Breakpoint.None" Dense="true" Striped="true" Bordered="true">
    <HeaderContent>
        <MudTh></MudTh>
        @foreach (var poke in Party)
        {
            <MudTh>
                <PokeImageView PokeNo="@poke.No" Fluid="true"/>
            </MudTh>
        }
        <MudTh>一貫</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="AttackTypeName">
            <PokeTypeView PokeType="@context.TypeName" SimpleText="true"/>
        </MudTd>
        @foreach (var (value, index) in Party.Select((value, index) => (value, index)))
        {
            <MudTd DataLabel="@($"Poke{index}")">
                <MudText Color="@context.Marks[index].MarkColor" Align="Align.Center">@context.Marks[index].Mark</MudText>
            </MudTd>
        }
        <MudTd DataLabel="Consistent">
            <MudText>@(context.Consistent ? "×": "")</MudText>
        </MudTd>
    </RowTemplate>
</MudTable>

@code {
    /// <summary>
    /// パーティ
    /// </summary>
    [Parameter]
    public PokeModel[] Party { get; set; } = new PokeModel[6] { new(), new(), new(), new(), new(), new() };

    /// <summary>
    /// テーブルデータ
    /// </summary>
    private List<PartyTypeEffectiveRowModel> elements = new();

    /// <summary>
    /// コンストラクタ
    /// </summary>
    /// <returns></returns>
    protected override void OnInitialized()
    {
        // タイプを行、ポケモンを列にするため、各タイプごとにポケモンの耐性を取得して行を作成
        elements.Clear();
        for (int typeIndex = 0; typeIndex < Common.TypeNameList.Length; typeIndex++)
        {
            PartyTypeEffectiveRowModel row = new();

            // タイプ名
            row.TypeName = Common.TypeNameList[typeIndex];

            // ポケモンごとの耐性
            for (int pokeIndex = 0; pokeIndex < Party.Length; pokeIndex++)
            {
                double effectiveValue = 1;
                if (!String.IsNullOrEmpty(Party[pokeIndex].Type1))
                {
                    effectiveValue *= Common.TypeEffectiveTable[typeIndex, Common.ConvertTypeNameToIndex(Party[pokeIndex].Type1)];
                }
                if (!String.IsNullOrEmpty(Party[pokeIndex].Type2))
                {
                    effectiveValue *= Common.TypeEffectiveTable[typeIndex, Common.ConvertTypeNameToIndex(Party[pokeIndex].Type2)];
                }
                row.Marks[pokeIndex] = Common.GetTypeResistance(effectiveValue);
            }

            // 一貫
            row.Consistent = !row.Marks.Any(value => value.EffectiveValue < 1);

            // テーブルに行追加
            elements.Add(row);
        }
    }
}